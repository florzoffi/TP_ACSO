==3972411== Helgrind, a thread error detector
==3972411== Copyright (C) 2007-2017, and GNU GPL'd, by OpenWorks LLP et al.
==3972411== Using Valgrind-3.22.0 and LibVEX; rerun with -h for copyright info
==3972411== Command: ./threadpool --all
==3972411== 
[36m[B01][0m Basic execution (3 tasks on 2 threads)... ==3972412== ---Thread-Announcement------------------------------------------
==3972412== 
==3972412== Thread #3 was created
==3972412==    at 0x4C3FA23: clone (clone.S:76)
==3972412==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972412==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972412==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972412==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972412==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972412==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412== 
==3972412== ---Thread-Announcement------------------------------------------
==3972412== 
==3972412== Thread #2 was created
==3972412==    at 0x4C3FA23: clone (clone.S:76)
==3972412==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972412==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972412==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972412==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972412==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972412==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412== 
==3972412== ---Thread-Announcement------------------------------------------
==3972412== 
==3972412== Thread #1 is the program's root thread
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972412==    by 0x4C3FA33: clone (clone.S:100)
==3972412== 
==3972412== This conflicts with a previous read of size 1 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==  Address 0x4e28628 is 152 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972412==    by 0x4C3FA33: clone (clone.S:100)
==3972412== 
==3972412== This conflicts with a previous write of size 1 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==  Address 0x4e28628 is 152 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972412==    by 0x4C3FA33: clone (clone.S:100)
==3972412== 
==3972412== This conflicts with a previous write of size 1 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==  Address 0x4e28628 is 152 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 4 at 0x4E28598 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972412==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous read of size 4 by thread #3
==3972412== Locks held: none
==3972412==    at 0x11397D: test_basic()::{lambda()#1}::operator()() const (test_custom.cc:64)
==3972412==    by 0x1234A5: void std::__invoke_impl<void, test_basic()::{lambda()#1}&>(std::__invoke_other, test_basic()::{lambda()#1}&) (invoke.h:61)
==3972412==    by 0x12026A: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_basic()::{lambda()#1}&>(test_basic()::{lambda()#1}&) (invoke.h:150)
==3972412==    by 0x11C7B6: std::_Function_handler<void (), test_basic()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972412==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==  Address 0x4e28598 is 8 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 8 at 0x4E285A0 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x1115D9: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972412==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous read of size 8 by thread #3
==3972412== Locks held: none
==3972412==    at 0x11398C: test_basic()::{lambda()#1}::operator()() const (test_custom.cc:64)
==3972412==    by 0x1234A5: void std::__invoke_impl<void, test_basic()::{lambda()#1}&>(std::__invoke_other, test_basic()::{lambda()#1}&) (invoke.h:61)
==3972412==    by 0x12026A: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_basic()::{lambda()#1}&>(test_basic()::{lambda()#1}&) (invoke.h:150)
==3972412==    by 0x11C7B6: std::_Function_handler<void (), test_basic()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972412==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==  Address 0x4e285a0 is 16 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972412==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous write of size 8 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972412==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x4e285a8 is 24 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972412==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous write of size 8 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972412==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x4e285a8 is 24 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972412==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous write of size 8 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972412==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x4e285b0 is 32 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972412==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972412==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972412==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412== 
==3972412== This conflicts with a previous write of size 8 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972412==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x4e285b0 is 32 bytes inside a block of size 320 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972412==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972412==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972412==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ---Thread-Announcement------------------------------------------
==3972412== 
==3972412== Thread #4 was created
==3972412==    at 0x4C3FA23: clone (clone.S:76)
==3972412==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972412==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972412==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972412==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972412==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972412==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972412==    by 0x1139DD: test_basic() (test_custom.cc:60)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 8 at 0x1FFEFFF060 by thread #2
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972412==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972412==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972412== 
==3972412== This conflicts with a previous read of size 8 by thread #4
==3972412== Locks held: none
==3972412==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972412==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972412==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972412==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==  Address 0x1ffefff060 is on thread #1's stack
==3972412==  in frame #6, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412== Possible data race during read of size 4 at 0x4E2BA34 by thread #1
==3972412== Locks held: none
==3972412==    at 0x485A01B: bcmp (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x130B49: int std::__memcmp<int, int>(int const*, int const*, unsigned long) (stl_algobase.h:108)
==3972412==    by 0x12FD41: bool std::__equal<true>::equal<int>(int const*, int const*, int const*) (stl_algobase.h:1185)
==3972412==    by 0x12EA91: bool std::__equal_aux1<int const*, int const*>(int const*, int const*, int const*) (stl_algobase.h:1219)
==3972412==    by 0x12D7CB: bool std::__equal_aux<__gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > > >(__gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >) (stl_algobase.h:1227)
==3972412==    by 0x12B808: bool std::equal<__gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > > >(__gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >, __gnu_cxx::__normal_iterator<int const*, std::vector<int, std::allocator<int> > >) (stl_algobase.h:1557)
==3972412==    by 0x129C84: bool std::operator==<int, std::allocator<int> >(std::vector<int, std::allocator<int> > const&, std::vector<int, std::allocator<int> > const&) (stl_vector.h:2042)
==3972412==    by 0x113B31: test_basic() (test_custom.cc:68)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412== 
==3972412== This conflicts with a previous write of size 4 by thread #4
==3972412== Locks held: none
==3972412==    at 0x11399E: test_basic()::{lambda()#1}::operator()() const (test_custom.cc:64)
==3972412==    by 0x1234A5: void std::__invoke_impl<void, test_basic()::{lambda()#1}&>(std::__invoke_other, test_basic()::{lambda()#1}&) (invoke.h:61)
==3972412==    by 0x12026A: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_basic()::{lambda()#1}&>(test_basic()::{lambda()#1}&) (invoke.h:150)
==3972412==    by 0x11C7B6: std::_Function_handler<void (), test_basic()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972412==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==  Address 0x4e2ba34 is 4 bytes inside a block of size 12 alloc'd
==3972412==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x12FCB5: std::__new_allocator<int>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972412==    by 0x12D718: allocate (alloc_traits.h:482)
==3972412==    by 0x12D718: std::_Vector_base<int, std::allocator<int> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972412==    by 0x12D62C: std::_Vector_base<int, std::allocator<int> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972412==    by 0x12B526: std::_Vector_base<int, std::allocator<int> >::_Vector_base(unsigned long, std::allocator<int> const&) (stl_vector.h:335)
==3972412==    by 0x129A94: std::vector<int, std::allocator<int> >::vector(unsigned long, int const&, std::allocator<int> const&) (stl_vector.h:571)
==3972412==    by 0x113A19: test_basic() (test_custom.cc:61)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972412==  Block was alloc'd by thread #1
==3972412== 
==3972412== ----------------------------------------------------------------
==3972412== 
==3972412==  Lock at 0x1FFEFFF028 was first observed
==3972412==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972412==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972412==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972412==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972412==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972412==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972412==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972412==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972412==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972412==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972412==  Address 0x1ffefff028 is on thread #1's stack
==3972412==  in frame #1, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== Possible data race during write of size 1 at 0x1FFEFFF020 by thread #1
==3972412== Locks held: 1, at address 0x1FFEFFF028
==3972412==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972412==    by 0x113B71: test_basic() (test_custom.cc:73)
==3972412==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972412==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972412==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972412==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972412==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972412==    by 0x119D91: main (test_custom.cc:942)
==3972412== 
==3972412== This conflicts with a previous read of size 1 by thread #3
==3972412== Locks held: none
==3972412==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972412==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972412==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972412==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972412==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972412==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972412==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972412==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972412==  Address 0x1ffefff020 is on thread #1's stack
==3972412==  in frame #1, created by test_basic() (test_custom.cc:58)
==3972412== 
==3972412== 
==3972412== Use --history-level=approx or =none to gain increased speed, at
==3972412== the cost of reduced accuracy of conflicting-access information
==3972412== For lists of detected and suppressed errors, rerun with: -s
==3972412== ERROR SUMMARY: 13 errors from 12 contexts (suppressed: 6391 from 19)
[1;31m❌ FAILED[0m
[36m[B02][0m Wait without scheduling... ==3972416== 
==3972416== Use --history-level=approx or =none to gain increased speed, at
==3972416== the cost of reduced accuracy of conflicting-access information
==3972416== For lists of detected and suppressed errors, rerun with: -s
==3972416== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 111 from 16)
[1;32m✅ PASSED[0m
[36m[B03][0m Serial execution with 1 thread... ==3972422== ---Thread-Announcement------------------------------------------
==3972422== 
==3972422== Thread #3 was created
==3972422==    at 0x4C3FA23: clone (clone.S:76)
==3972422==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972422==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972422==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972422==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972422==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972422==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422== 
==3972422== ---Thread-Announcement------------------------------------------
==3972422== 
==3972422== Thread #2 was created
==3972422==    at 0x4C3FA23: clone (clone.S:76)
==3972422==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972422==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972422==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972422==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972422==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972422==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422== 
==3972422== ---Thread-Announcement------------------------------------------
==3972422== 
==3972422== Thread #1 is the program's root thread
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972422==    by 0x4C3FA33: clone (clone.S:100)
==3972422== 
==3972422== This conflicts with a previous read of size 1 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972422==    by 0x4C3FA33: clone (clone.S:100)
==3972422== 
==3972422== This conflicts with a previous write of size 1 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972422==    by 0x4C3FA33: clone (clone.S:100)
==3972422== 
==3972422== This conflicts with a previous write of size 1 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972422==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972422==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972422==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422== 
==3972422== This conflicts with a previous read of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x12358A: std::_Function_base::_Base_manager<test_serial_execution()::{lambda()#1}>::_M_destroy(std::_Any_data&, std::integral_constant<bool, false>) (std_function.h:175)
==3972422==    by 0x12047F: std::_Function_base::_Base_manager<test_serial_execution()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:203)
==3972422==    by 0x11C921: std::_Function_handler<void (), test_serial_execution()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:282)
==3972422==    by 0x10FF4C: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:505)
==3972422==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==  Address 0x4e28598 is 8 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972422==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972422==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972422==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422== 
==3972422== This conflicts with a previous write of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972422==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x4e285a8 is 24 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972422==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972422==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972422==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422== 
==3972422== This conflicts with a previous write of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972422==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x4e285a8 is 24 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972422==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972422==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972422==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422== 
==3972422== This conflicts with a previous write of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972422==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x4e285b0 is 32 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972422==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972422==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972422==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422== 
==3972422== This conflicts with a previous write of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972422==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x4e285b0 is 32 bytes inside a block of size 160 alloc'd
==3972422==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972422==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972422==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972422==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972422==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972422==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972422==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972422==    by 0x113E08: test_serial_execution() (test_custom.cc:92)
==3972422==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972422==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972422==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972422==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972422==  Block was alloc'd by thread #1
==3972422== 
==3972422== ----------------------------------------------------------------
==3972422== 
==3972422==  Lock at 0x1FFEFFEEB8 was first observed
==3972422==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972422==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972422==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972422==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972422==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==  Address 0x1ffeffeeb8 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== Possible data race during write of size 8 at 0x1FFEFFEEF0 by thread #2
==3972422== Locks held: 1, at address 0x1FFEFFEEB8
==3972422==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972422==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972422==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972422==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972422==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972422==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972422==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972422==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972422==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972422==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972422==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972422== 
==3972422== This conflicts with a previous read of size 8 by thread #3
==3972422== Locks held: none
==3972422==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972422==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972422==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972422==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972422==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972422==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972422==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972422==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972422==  Address 0x1ffeffeef0 is on thread #1's stack
==3972422==  in frame #6, created by test_serial_execution() (test_custom.cc:88)
==3972422== 
==3972422== 
==3972422== Use --history-level=approx or =none to gain increased speed, at
==3972422== the cost of reduced accuracy of conflicting-access information
==3972422== For lists of detected and suppressed errors, rerun with: -s
==3972422== ERROR SUMMARY: 36 errors from 9 contexts (suppressed: 7560 from 19)
[1;31m❌ FAILED[0m
[36m[B04][0m FIFO execution in single-thread mode... ==3972425== ---Thread-Announcement------------------------------------------
==3972425== 
==3972425== Thread #3 was created
==3972425==    at 0x4C3FA23: clone (clone.S:76)
==3972425==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972425==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972425==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972425==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972425==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972425==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425== 
==3972425== ---Thread-Announcement------------------------------------------
==3972425== 
==3972425== Thread #2 was created
==3972425==    at 0x4C3FA23: clone (clone.S:76)
==3972425==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972425==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972425==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972425==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972425==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972425==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425== 
==3972425== ---Thread-Announcement------------------------------------------
==3972425== 
==3972425== Thread #1 is the program's root thread
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972425==    by 0x4C3FA33: clone (clone.S:100)
==3972425== 
==3972425== This conflicts with a previous read of size 1 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972425==    by 0x4C3FA33: clone (clone.S:100)
==3972425== 
==3972425== This conflicts with a previous write of size 1 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972425==    by 0x4C3FA33: clone (clone.S:100)
==3972425== 
==3972425== This conflicts with a previous write of size 1 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==  Address 0x4e28628 is 152 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972425==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972425==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972425==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425== 
==3972425== This conflicts with a previous read of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x123632: std::_Function_base::_Base_manager<test_fifo_single_thread()::{lambda()#1}>::_M_destroy(std::_Any_data&, std::integral_constant<bool, false>) (std_function.h:175)
==3972425==    by 0x1205DD: std::_Function_base::_Base_manager<test_fifo_single_thread()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:203)
==3972425==    by 0x11CA15: std::_Function_handler<void (), test_fifo_single_thread()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:282)
==3972425==    by 0x10FF4C: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:505)
==3972425==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==  Address 0x4e28598 is 8 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972425==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972425==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972425==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425== 
==3972425== This conflicts with a previous write of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972425==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x4e285a8 is 24 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972425==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972425==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972425==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425== 
==3972425== This conflicts with a previous write of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972425==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x4e285a8 is 24 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972425==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972425==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972425==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425== 
==3972425== This conflicts with a previous write of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972425==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x4e285b0 is 32 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972425==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972425==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972425==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425== 
==3972425== This conflicts with a previous write of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972425==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x4e285b0 is 32 bytes inside a block of size 160 alloc'd
==3972425==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972425==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972425==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972425==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972425==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972425==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972425==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972425==    by 0x114057: test_fifo_single_thread() (test_custom.cc:108)
==3972425==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972425==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972425==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972425==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972425==  Block was alloc'd by thread #1
==3972425== 
==3972425== ----------------------------------------------------------------
==3972425== 
==3972425==  Lock at 0x1FFEFFF038 was first observed
==3972425==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972425==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972425==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972425==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972425==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==  Address 0x1ffefff038 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972425== Locks held: 1, at address 0x1FFEFFF038
==3972425==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972425==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972425==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972425==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972425==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972425==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972425==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972425==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972425==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972425==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972425==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972425== 
==3972425== This conflicts with a previous read of size 8 by thread #3
==3972425== Locks held: none
==3972425==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972425==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972425==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972425==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972425==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972425==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972425==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972425==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972425==  Address 0x1ffefff070 is on thread #1's stack
==3972425==  in frame #6, created by test_fifo_single_thread() (test_custom.cc:106)
==3972425== 
==3972425== 
==3972425== Use --history-level=approx or =none to gain increased speed, at
==3972425== the cost of reduced accuracy of conflicting-access information
==3972425== For lists of detected and suppressed errors, rerun with: -s
==3972425== ERROR SUMMARY: 81 errors from 9 contexts (suppressed: 59973 from 19)
[1;31m❌ FAILED[0m
[32m[C01][0m Stress with 1000 tasks... ==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #4 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972428==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #2 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972428==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #1 is the program's root thread
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 1 at 0x4E286C8 by thread #4
==3972428== Locks held: none
==3972428==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972428==    by 0x4C3FA33: clone (clone.S:100)
==3972428== 
==3972428== This conflicts with a previous read of size 1 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==  Address 0x4e286c8 is 312 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #3 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972428==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972428==    by 0x4C3FA33: clone (clone.S:100)
==3972428== 
==3972428== This conflicts with a previous write of size 1 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==  Address 0x4e28628 is 152 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972428==    by 0x4C3FA33: clone (clone.S:100)
==3972428== 
==3972428== This conflicts with a previous write of size 1 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==  Address 0x4e28628 is 152 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 4 at 0x4E28598 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972428==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous read of size 4 by thread #3
==3972428== Locks held: none
==3972428==    at 0x11420E: test_concurrent_stress()::{lambda()#1}::operator()() const (test_custom.cc:141)
==3972428==    by 0x12369B: void std::__invoke_impl<void, test_concurrent_stress()::{lambda()#1}&>(std::__invoke_other, test_concurrent_stress()::{lambda()#1}&) (invoke.h:61)
==3972428==    by 0x120686: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_concurrent_stress()::{lambda()#1}&>(test_concurrent_stress()::{lambda()#1}&) (invoke.h:150)
==3972428==    by 0x11CA92: std::_Function_handler<void (), test_concurrent_stress()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972428==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==  Address 0x4e28598 is 8 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 8 at 0x4E285A0 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x1115D9: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972428==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous read of size 8 by thread #3
==3972428== Locks held: none
==3972428==    at 0x114217: test_concurrent_stress()::{lambda()#1}::operator()() const (test_custom.cc:141)
==3972428==    by 0x12369B: void std::__invoke_impl<void, test_concurrent_stress()::{lambda()#1}&>(std::__invoke_other, test_concurrent_stress()::{lambda()#1}&) (invoke.h:61)
==3972428==    by 0x120686: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_concurrent_stress()::{lambda()#1}&>(test_concurrent_stress()::{lambda()#1}&) (invoke.h:150)
==3972428==    by 0x11CA92: std::_Function_handler<void (), test_concurrent_stress()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972428==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==  Address 0x4e285a0 is 16 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972428==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous write of size 8 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972428==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x4e285a8 is 24 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972428==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous write of size 8 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972428==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x4e285a8 is 24 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972428==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous write of size 8 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972428==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x4e285b0 is 32 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972428==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972428==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972428==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous write of size 8 by thread #3
==3972428== Locks held: none
==3972428==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972428==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x4e285b0 is 32 bytes inside a block of size 1,280 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972428==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972428==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972428==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #5 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972428==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #5
==3972428== Locks held: none
==3972428==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972428==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972428==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972428==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428== 
==3972428== This conflicts with a previous write of size 8 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972428==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972428==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==  Address 0x1ffefff070 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972428==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972428==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972428== 
==3972428== This conflicts with a previous read of size 8 by thread #5
==3972428== Locks held: none
==3972428==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972428==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972428==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972428==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==  Address 0x1ffefff070 is on thread #1's stack
==3972428==  in frame #6, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #6 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972428==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428== Possible data race during read of size 4 at 0x4E2C55C by thread #1
==3972428== Locks held: none
==3972428==    at 0x11438C: test_concurrent_stress() (test_custom.cc:145)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972428==    by 0x119D91: main (test_custom.cc:942)
==3972428== 
==3972428== This conflicts with a previous write of size 4 by thread #6
==3972428== Locks held: none
==3972428==    at 0x114226: test_concurrent_stress()::{lambda()#1}::operator()() const (test_custom.cc:141)
==3972428==    by 0x12369B: void std::__invoke_impl<void, test_concurrent_stress()::{lambda()#1}&>(std::__invoke_other, test_concurrent_stress()::{lambda()#1}&) (invoke.h:61)
==3972428==    by 0x120686: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_concurrent_stress()::{lambda()#1}&>(test_concurrent_stress()::{lambda()#1}&) (invoke.h:150)
==3972428==    by 0x11CA92: std::_Function_handler<void (), test_concurrent_stress()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972428==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==  Address 0x4e2c55c is 3,964 bytes inside a block of size 4,000 alloc'd
==3972428==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x12FCB5: std::__new_allocator<int>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972428==    by 0x12D718: allocate (alloc_traits.h:482)
==3972428==    by 0x12D718: std::_Vector_base<int, std::allocator<int> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972428==    by 0x12D62C: std::_Vector_base<int, std::allocator<int> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972428==    by 0x12B526: std::_Vector_base<int, std::allocator<int> >::_Vector_base(unsigned long, std::allocator<int> const&) (stl_vector.h:335)
==3972428==    by 0x129A94: std::vector<int, std::allocator<int> >::vector(unsigned long, int const&, std::allocator<int> const&) (stl_vector.h:571)
==3972428==    by 0x114293: test_concurrent_stress() (test_custom.cc:137)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972428==  Block was alloc'd by thread #1
==3972428== 
==3972428== ---Thread-Announcement------------------------------------------
==3972428== 
==3972428== Thread #8 was created
==3972428==    at 0x4C3FA23: clone (clone.S:76)
==3972428==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972428==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972428==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972428==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972428==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972428==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972428==    by 0x1142B7: test_concurrent_stress() (test_custom.cc:138)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428== 
==3972428== ----------------------------------------------------------------
==3972428== 
==3972428==  Lock at 0x1FFEFFF038 was first observed
==3972428==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972428==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972428==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972428==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972428==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972428==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972428==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972428==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972428==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972428==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972428==  Address 0x1ffefff038 is on thread #1's stack
==3972428==  in frame #1, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972428== Locks held: 1, at address 0x1FFEFFF038
==3972428==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972428==    by 0x1143E3: test_concurrent_stress() (test_custom.cc:148)
==3972428==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972428==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972428==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972428==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972428==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972428==    by 0x119D91: main (test_custom.cc:942)
==3972428== 
==3972428== This conflicts with a previous read of size 1 by thread #8
==3972428== Locks held: none
==3972428==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972428==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972428==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972428==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972428==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972428==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972428==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972428==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972428==  Address 0x1ffefff030 is on thread #1's stack
==3972428==  in frame #1, created by test_concurrent_stress() (test_custom.cc:134)
==3972428== 
==3972428== 
==3972428== Use --history-level=approx or =none to gain increased speed, at
==3972428== the cost of reduced accuracy of conflicting-access information
==3972428== For lists of detected and suppressed errors, rerun with: -s
==3972428== ERROR SUMMARY: 8948 errors from 13 contexts (suppressed: 386658 from 19)
[1;31m❌ FAILED[0m
[32m[C02][0m Reusing the pool after wait... ==3972440== 
==3972440== Use --history-level=approx or =none to gain increased speed, at
==3972440== the cost of reduced accuracy of conflicting-access information
==3972440== For lists of detected and suppressed errors, rerun with: -s
==3972440== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 257 from 20)
[1;32m✅ PASSED[0m
[32m[C03][0m Multiple wait() calls... ==3972446== 
==3972446== Use --history-level=approx or =none to gain increased speed, at
==3972446== the cost of reduced accuracy of conflicting-access information
==3972446== For lists of detected and suppressed errors, rerun with: -s
==3972446== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 183 from 19)
[1;32m✅ PASSED[0m
[35m[E01][0m Massive stress (10k tasks)... ==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #4 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972452==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #2 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972452==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #1 is the program's root thread
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 1 at 0x4E2B718 by thread #4
==3972452== Locks held: none
==3972452==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972452==    by 0x4C3FA33: clone (clone.S:100)
==3972452== 
==3972452== This conflicts with a previous read of size 1 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==  Address 0x4e2b718 is 312 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #3 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972452==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during read of size 1 at 0x4E2B678 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972452==    by 0x4C3FA33: clone (clone.S:100)
==3972452== 
==3972452== This conflicts with a previous write of size 1 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==  Address 0x4e2b678 is 152 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 1 at 0x4E2B678 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972452==    by 0x4C3FA33: clone (clone.S:100)
==3972452== 
==3972452== This conflicts with a previous write of size 1 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==  Address 0x4e2b678 is 152 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 8 at 0x4E2B5E8 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972452==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972452==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972452==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous read of size 8 by thread #3
==3972452== Locks held: none
==3972452==    at 0x1147D0: test_massive_stress()::{lambda()#1}::operator()() const (test_custom.cc:199)
==3972452==    by 0x123933: void std::__invoke_impl<void, test_massive_stress()::{lambda()#1}&>(std::__invoke_other, test_massive_stress()::{lambda()#1}&) (invoke.h:61)
==3972452==    by 0x120BE6: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_massive_stress()::{lambda()#1}&>(test_massive_stress()::{lambda()#1}&) (invoke.h:150)
==3972452==    by 0x11CE62: std::_Function_handler<void (), test_massive_stress()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972452==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==  Address 0x4e2b5e8 is 8 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during read of size 8 at 0x4E2B5F8 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972452==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972452==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972452==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous write of size 8 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972452==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x4e2b5f8 is 24 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 8 at 0x4E2B5F8 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972452==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972452==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972452==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous write of size 8 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972452==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x4e2b5f8 is 24 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during read of size 8 at 0x4E2B600 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972452==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972452==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972452==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous write of size 8 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972452==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x4e2b600 is 32 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 8 at 0x4E2B600 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972452==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972452==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972452==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous write of size 8 by thread #3
==3972452== Locks held: none
==3972452==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972452==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x4e2b600 is 32 bytes inside a block of size 2,560 alloc'd
==3972452==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972452==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972452==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972452==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972452==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972452==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972452==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==  Block was alloc'd by thread #1
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #7 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972452==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #7
==3972452== Locks held: none
==3972452==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972452==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972452==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972452==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous write of size 8 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972452==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972452==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==  Address 0x1ffefff070 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972452==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972452==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972452== 
==3972452== This conflicts with a previous read of size 8 by thread #7
==3972452== Locks held: none
==3972452==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972452==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972452==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972452==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==  Address 0x1ffefff070 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #13 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972452==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x111773: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::_M_pop_front_aux() (deque.tcc:583)
==3972452==    by 0x110B0D: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1585)
==3972452==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972452==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452== 
==3972452== This conflicts with a previous read of size 8 by thread #13
==3972452== Locks held: none
==3972452==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972452==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972452==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972452==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==  Address 0x1ffefff070 is on thread #1's stack
==3972452==  in frame #6, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== ---Thread-Announcement------------------------------------------
==3972452== 
==3972452== Thread #14 was created
==3972452==    at 0x4C3FA23: clone (clone.S:76)
==3972452==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972452==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972452==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972452==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972452==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972452==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972452==    by 0x114829: test_massive_stress() (test_custom.cc:196)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452== 
==3972452== ----------------------------------------------------------------
==3972452== 
==3972452==  Lock at 0x1FFEFFF038 was first observed
==3972452==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972452==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972452==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972452==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972452==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972452==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972452==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972452==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972452==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972452==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972452==  Address 0x1ffefff038 is on thread #1's stack
==3972452==  in frame #1, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972452== Locks held: 1, at address 0x1FFEFFF038
==3972452==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972452==    by 0x1148CC: test_massive_stress() (test_custom.cc:204)
==3972452==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972452==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972452==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972452==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972452==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972452==    by 0x119D91: main (test_custom.cc:942)
==3972452== 
==3972452== This conflicts with a previous read of size 1 by thread #14
==3972452== Locks held: none
==3972452==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972452==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972452==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972452==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972452==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972452==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972452==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972452==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972452==  Address 0x1ffefff030 is on thread #1's stack
==3972452==  in frame #1, created by test_massive_stress() (test_custom.cc:192)
==3972452== 
==3972452== 
==3972452== Use --history-level=approx or =none to gain increased speed, at
==3972452== the cost of reduced accuracy of conflicting-access information
==3972452== For lists of detected and suppressed errors, rerun with: -s
==3972452== ERROR SUMMARY: 80060 errors from 12 contexts (suppressed: 1316770 from 19)
[1;31m❌ FAILED[0m
[35m[E02][0m Long tasks then shutdown... ==3972474== ---Thread-Announcement------------------------------------------
==3972474== 
==3972474== Thread #3 was created
==3972474==    at 0x4C3FA23: clone (clone.S:76)
==3972474==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972474==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972474==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972474==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972474==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972474==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474== 
==3972474== ---Thread-Announcement------------------------------------------
==3972474== 
==3972474== Thread #2 was created
==3972474==    at 0x4C3FA23: clone (clone.S:76)
==3972474==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972474==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972474==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972474==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972474==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972474==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474== 
==3972474== ---Thread-Announcement------------------------------------------
==3972474== 
==3972474== Thread #1 is the program's root thread
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972474==    by 0x4C3FA33: clone (clone.S:100)
==3972474== 
==3972474== This conflicts with a previous read of size 1 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972474==    by 0x4C3FA33: clone (clone.S:100)
==3972474== 
==3972474== This conflicts with a previous write of size 1 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972474==    by 0x4C3FA33: clone (clone.S:100)
==3972474== 
==3972474== This conflicts with a previous write of size 1 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972474==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972474==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972474==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474== 
==3972474== This conflicts with a previous write of size 8 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972474==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972474==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972474==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972474==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474== 
==3972474== This conflicts with a previous write of size 8 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972474==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972474==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972474==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972474==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474== 
==3972474== This conflicts with a previous write of size 8 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972474==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972474==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972474==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972474==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474== 
==3972474== This conflicts with a previous write of size 8 by thread #3
==3972474== Locks held: none
==3972474==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972474==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972474==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972474==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972474==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972474==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972474==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972474==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972474==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==  Block was alloc'd by thread #1
==3972474== 
==3972474== ---Thread-Announcement------------------------------------------
==3972474== 
==3972474== Thread #6 was created
==3972474==    at 0x4C3FA23: clone (clone.S:76)
==3972474==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972474==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972474==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972474==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972474==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972474==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972474==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972474==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972474== 
==3972474== This conflicts with a previous read of size 8 by thread #6
==3972474== Locks held: none
==3972474==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972474==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972474==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972474==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==  Address 0x1ffefff070 is on thread #1's stack
==3972474==  in frame #6, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== ---Thread-Announcement------------------------------------------
==3972474== 
==3972474== Thread #4 was created
==3972474==    at 0x4C3FA23: clone (clone.S:76)
==3972474==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972474==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972474==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972474==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972474==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972474==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972474==    by 0x114981: test_long_tasks_then_quit() (test_custom.cc:211)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474== 
==3972474== ----------------------------------------------------------------
==3972474== 
==3972474==  Lock at 0x1FFEFFF038 was first observed
==3972474==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972474==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972474==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972474==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972474==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972474==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972474==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972474==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972474==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972474==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972474==  Address 0x1ffefff038 is on thread #1's stack
==3972474==  in frame #1, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972474== Locks held: 1, at address 0x1FFEFFF038
==3972474==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972474==    by 0x114A01: test_long_tasks_then_quit() (test_custom.cc:219)
==3972474==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972474==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972474==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972474==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972474==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972474==    by 0x119D91: main (test_custom.cc:942)
==3972474== 
==3972474== This conflicts with a previous read of size 1 by thread #4
==3972474== Locks held: none
==3972474==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972474==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972474==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972474==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972474==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972474==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972474==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972474==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972474==  Address 0x1ffefff030 is on thread #1's stack
==3972474==  in frame #1, created by test_long_tasks_then_quit() (test_custom.cc:209)
==3972474== 
==3972474== 
==3972474== Use --history-level=approx or =none to gain increased speed, at
==3972474== the cost of reduced accuracy of conflicting-access information
==3972474== For lists of detected and suppressed errors, rerun with: -s
==3972474== ERROR SUMMARY: 50 errors from 9 contexts (suppressed: 83167 from 19)
[1;31m❌ FAILED[0m
[35m[E03][0m Lots of short tasks on few threads... ==3972480== ---Thread-Announcement------------------------------------------
==3972480== 
==3972480== Thread #4 was created
==3972480==    at 0x4C3FA23: clone (clone.S:76)
==3972480==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972480==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972480==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972480==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972480==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972480==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480== 
==3972480== ---Thread-Announcement------------------------------------------
==3972480== 
==3972480== Thread #2 was created
==3972480==    at 0x4C3FA23: clone (clone.S:76)
==3972480==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972480==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972480==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972480==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972480==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972480==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480== 
==3972480== ---Thread-Announcement------------------------------------------
==3972480== 
==3972480== Thread #1 is the program's root thread
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 1 at 0x4E286C8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972480==    by 0x4C3FA33: clone (clone.S:100)
==3972480== 
==3972480== This conflicts with a previous read of size 1 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during read of size 1 at 0x4E286C8 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972480==    by 0x4C3FA33: clone (clone.S:100)
==3972480== 
==3972480== This conflicts with a previous write of size 1 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 1 at 0x4E286C8 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972480==    by 0x4C3FA33: clone (clone.S:100)
==3972480== 
==3972480== This conflicts with a previous write of size 1 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 8 at 0x4E28638 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972480==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972480==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972480==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous read of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x114A86: test_many_short_tasks_on_few_threads()::{lambda()#1}::operator()() const (test_custom.cc:231)
==3972480==    by 0x123A7F: void std::__invoke_impl<void, test_many_short_tasks_on_few_threads()::{lambda()#1}&>(std::__invoke_other, test_many_short_tasks_on_few_threads()::{lambda()#1}&) (invoke.h:61)
==3972480==    by 0x120E88: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_many_short_tasks_on_few_threads()::{lambda()#1}&>(test_many_short_tasks_on_few_threads()::{lambda()#1}&) (invoke.h:150)
==3972480==    by 0x11D04A: std::_Function_handler<void (), test_many_short_tasks_on_few_threads()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972480==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==  Address 0x4e28638 is 168 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during read of size 8 at 0x4E28648 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972480==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972480==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972480==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous write of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972480==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x4e28648 is 184 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 8 at 0x4E28648 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972480==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972480==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972480==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous write of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972480==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x4e28648 is 184 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during read of size 8 at 0x4E28650 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972480==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972480==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972480==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous write of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972480==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x4e28650 is 192 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 8 at 0x4E28650 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972480==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972480==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972480==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous write of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972480==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x4e28650 is 192 bytes inside a block of size 320 alloc'd
==3972480==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972480==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972480==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972480==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972480==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972480==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972480==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972480==    by 0x114ACB: test_many_short_tasks_on_few_threads() (test_custom.cc:226)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==  Block was alloc'd by thread #1
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #4
==3972480== Locks held: none
==3972480==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972480==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972480==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972480==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous write of size 8 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972480==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972480==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==  Address 0x1ffefff070 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972480==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972480==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972480== 
==3972480== This conflicts with a previous read of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972480==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972480==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972480==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==  Address 0x1ffefff070 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x111773: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::_M_pop_front_aux() (deque.tcc:583)
==3972480==    by 0x110B0D: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1585)
==3972480==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972480==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480== 
==3972480== This conflicts with a previous read of size 8 by thread #4
==3972480== Locks held: none
==3972480==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972480==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972480==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972480==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==  Address 0x1ffefff070 is on thread #1's stack
==3972480==  in frame #6, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== ----------------------------------------------------------------
==3972480== 
==3972480==  Lock at 0x1FFEFFF038 was first observed
==3972480==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972480==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972480==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972480==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972480==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972480==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972480==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972480==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972480==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972480==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972480==  Address 0x1ffefff038 is on thread #1's stack
==3972480==  in frame #1, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972480== Locks held: 1, at address 0x1FFEFFF038
==3972480==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972480==    by 0x114B78: test_many_short_tasks_on_few_threads() (test_custom.cc:236)
==3972480==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972480==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972480==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972480==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972480==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972480==    by 0x119D91: main (test_custom.cc:942)
==3972480== 
==3972480== This conflicts with a previous read of size 1 by thread #4
==3972480== Locks held: none
==3972480==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972480==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972480==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972480==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972480==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972480==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972480==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972480==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972480==  Address 0x1ffefff030 is on thread #1's stack
==3972480==  in frame #1, created by test_many_short_tasks_on_few_threads() (test_custom.cc:224)
==3972480== 
==3972480== 
==3972480== Use --history-level=approx or =none to gain increased speed, at
==3972480== the cost of reduced accuracy of conflicting-access information
==3972480== For lists of detected and suppressed errors, rerun with: -s
==3972480== ERROR SUMMARY: 1678 errors from 12 contexts (suppressed: 755254 from 19)
[1;31m❌ FAILED[0m
[35m[E04][0m Detect potential deadlock... ==3972558== ---Thread-Announcement------------------------------------------
==3972558== 
==3972558== Thread #2 was created
==3972558==    at 0x4C3FA23: clone (clone.S:76)
==3972558==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972558==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972558==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972558==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972558==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972558==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972558==    by 0x11ACF2: std::thread::thread<test_potential_deadlock()::{lambda()#1}, , void>(test_potential_deadlock()::{lambda()#1}&&) (std_thread.h:164)
==3972558==    by 0x114F6B: test_potential_deadlock() (test_custom.cc:281)
==3972558==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972558==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972558==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972558==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972558== 
==3972558== ----------------------------------------------------------------
==3972558== 
==3972558== Thread #2: pthread_cond_{signal,broadcast}: dubious: associated lock is not held by any thread
==3972558==    at 0x4851C1D: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972558==    by 0x114E1C: test_potential_deadlock()::{lambda()#1}::operator()() const (test_custom.cc:275)
==3972558==    by 0x127AAD: void std::__invoke_impl<void, test_potential_deadlock()::{lambda()#1}>(std::__invoke_other, test_potential_deadlock()::{lambda()#1}&&) (invoke.h:61)
==3972558==    by 0x1277D1: std::__invoke_result<test_potential_deadlock()::{lambda()#1}>::type std::__invoke<test_potential_deadlock()::{lambda()#1}>(test_potential_deadlock()::{lambda()#1}&&) (invoke.h:96)
==3972558==    by 0x1273ED: void std::thread::_Invoker<std::tuple<test_potential_deadlock()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972558==    by 0x1271DD: std::thread::_Invoker<std::tuple<test_potential_deadlock()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972558==    by 0x12708D: std::thread::_State_impl<std::thread::_Invoker<std::tuple<test_potential_deadlock()::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972558==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972558==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972558==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972558==    by 0x4C3FA33: clone (clone.S:100)
==3972558== 
==3972558== 
==3972558== Use --history-level=approx or =none to gain increased speed, at
==3972558== the cost of reduced accuracy of conflicting-access information
==3972558== For lists of detected and suppressed errors, rerun with: -s
==3972558== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 139 from 27)
[1;31m❌ FAILED[0m
[35m[E05][0m Simulated pendingTasks tracking... ==3972587== ---Thread-Announcement------------------------------------------
==3972587== 
==3972587== Thread #3 was created
==3972587==    at 0x4C3FA23: clone (clone.S:76)
==3972587==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972587==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972587==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972587==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972587==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972587==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587== 
==3972587== ---Thread-Announcement------------------------------------------
==3972587== 
==3972587== Thread #2 was created
==3972587==    at 0x4C3FA23: clone (clone.S:76)
==3972587==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972587==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972587==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972587==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972587==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972587==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587== 
==3972587== ---Thread-Announcement------------------------------------------
==3972587== 
==3972587== Thread #1 is the program's root thread
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972587==    by 0x4C3FA33: clone (clone.S:100)
==3972587== 
==3972587== This conflicts with a previous read of size 1 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972587==    by 0x4C3FA33: clone (clone.S:100)
==3972587== 
==3972587== This conflicts with a previous write of size 1 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972587==    by 0x4C3FA33: clone (clone.S:100)
==3972587== 
==3972587== This conflicts with a previous write of size 1 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972587==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972587==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972587==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous read of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x1150C6: test_pending_tasks_tracking_simulado()::{lambda()#1}::operator()() const (test_custom.cc:304)
==3972587==    by 0x123BFF: void std::__invoke_impl<void, test_pending_tasks_tracking_simulado()::{lambda()#1}&>(std::__invoke_other, test_pending_tasks_tracking_simulado()::{lambda()#1}&) (invoke.h:61)
==3972587==    by 0x121173: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_pending_tasks_tracking_simulado()::{lambda()#1}&>(test_pending_tasks_tracking_simulado()::{lambda()#1}&) (invoke.h:150)
==3972587==    by 0x11D322: std::_Function_handler<void (), test_pending_tasks_tracking_simulado()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972587==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==  Address 0x4e28598 is 8 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972587==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972587==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972587==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous write of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972587==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972587==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972587==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972587==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous write of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972587==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972587==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972587==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972587==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous write of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972587==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972587==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972587==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972587==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous write of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972587==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972587==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972587==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972587==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972587==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972587==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972587==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972587==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==  Block was alloc'd by thread #1
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #3
==3972587== Locks held: none
==3972587==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972587==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972587==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972587==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587== 
==3972587== This conflicts with a previous write of size 8 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972587==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972587==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==  Address 0x1ffefff070 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972587==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972587==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972587== 
==3972587== This conflicts with a previous read of size 8 by thread #3
==3972587== Locks held: none
==3972587==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972587==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972587==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972587==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==  Address 0x1ffefff070 is on thread #1's stack
==3972587==  in frame #6, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== ---Thread-Announcement------------------------------------------
==3972587== 
==3972587== Thread #5 was created
==3972587==    at 0x4C3FA23: clone (clone.S:76)
==3972587==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972587==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972587==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972587==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972587==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972587==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972587==    by 0x11510B: test_pending_tasks_tracking_simulado() (test_custom.cc:297)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587== 
==3972587== ----------------------------------------------------------------
==3972587== 
==3972587==  Lock at 0x1FFEFFF038 was first observed
==3972587==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972587==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972587==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972587==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972587==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972587==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972587==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972587==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972587==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972587==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972587==  Address 0x1ffefff038 is on thread #1's stack
==3972587==  in frame #1, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972587== Locks held: 1, at address 0x1FFEFFF038
==3972587==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972587==    by 0x1151B3: test_pending_tasks_tracking_simulado() (test_custom.cc:309)
==3972587==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972587==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972587==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972587==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972587==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972587==    by 0x119D91: main (test_custom.cc:942)
==3972587== 
==3972587== This conflicts with a previous read of size 1 by thread #5
==3972587== Locks held: none
==3972587==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972587==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972587==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972587==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972587==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972587==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972587==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972587==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972587==  Address 0x1ffefff030 is on thread #1's stack
==3972587==  in frame #1, created by test_pending_tasks_tracking_simulado() (test_custom.cc:295)
==3972587== 
==3972587== 
==3972587== Use --history-level=approx or =none to gain increased speed, at
==3972587== the cost of reduced accuracy of conflicting-access information
==3972587== For lists of detected and suppressed errors, rerun with: -s
==3972587== ERROR SUMMARY: 778 errors from 11 contexts (suppressed: 85558 from 19)
[1;31m❌ FAILED[0m
[34m[F01][0m Schedule from multiple threads... ==3972973== ---Thread-Announcement------------------------------------------
==3972973== 
==3972973== Thread #6 was created
==3972973==    at 0x4C3FA23: clone (clone.S:76)
==3972973==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972973==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972973==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972973==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972973==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972973==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973== 
==3972973== ---Thread-Announcement------------------------------------------
==3972973== 
==3972973== Thread #2 was created
==3972973==    at 0x4C3FA23: clone (clone.S:76)
==3972973==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972973==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972973==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972973==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972973==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972973==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973== 
==3972973== ---Thread-Announcement------------------------------------------
==3972973== 
==3972973== Thread #1 is the program's root thread
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 1 at 0x4E28808 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972973==    by 0x4C3FA33: clone (clone.S:100)
==3972973== 
==3972973== This conflicts with a previous read of size 1 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==  Address 0x4e28808 is 632 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during read of size 1 at 0x4E28808 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972973==    by 0x4C3FA33: clone (clone.S:100)
==3972973== 
==3972973== This conflicts with a previous write of size 1 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==  Address 0x4e28808 is 632 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 1 at 0x4E28808 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972973==    by 0x4C3FA33: clone (clone.S:100)
==3972973== 
==3972973== This conflicts with a previous write of size 1 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==  Address 0x4e28808 is 632 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 8 at 0x4E28778 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972973==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972973==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972973==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous read of size 8 by thread #6
==3972973== Locks held: none
==3972973==    at 0x11522E: test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}::operator()() const (test_custom.cc:328)
==3972973==    by 0x123CA5: void std::__invoke_impl<void, test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}&>(std::__invoke_other, test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:61)
==3972973==    by 0x1212CC: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}&>(test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:150)
==3972973==    by 0x11D416: std::_Function_handler<void (), test_schedule_from_multiple_threads()::{lambda()#1}::operator()() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3972973==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==  Address 0x4e28778 is 488 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during read of size 8 at 0x4E28788 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972973==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972973==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972973==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous write of size 8 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972973==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x4e28788 is 504 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 8 at 0x4E28788 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972973==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972973==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972973==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous write of size 8 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972973==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x4e28788 is 504 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during read of size 8 at 0x4E28790 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972973==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972973==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972973==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous write of size 8 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972973==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x4e28790 is 512 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #4, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 8 at 0x4E28790 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972973==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972973==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972973==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous write of size 8 by thread #6
==3972973== Locks held: none
==3972973==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972973==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x4e28790 is 512 bytes inside a block of size 1,280 alloc'd
==3972973==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972973==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972973==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972973==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972973==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972973==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972973==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==  Block was alloc'd by thread #1
==3972973== 
==3972973== ---Thread-Announcement------------------------------------------
==3972973== 
==3972973== Thread #10 was created
==3972973==    at 0x4C3FA23: clone (clone.S:76)
==3972973==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972973==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972973==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972973==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972973==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972973==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #6, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972973==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972973==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972973== 
==3972973== This conflicts with a previous read of size 8 by thread #10
==3972973== Locks held: none
==3972973==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972973==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972973==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972973==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==  Address 0x1ffefff070 is on thread #1's stack
==3972973==  in frame #6, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #6, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x111773: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::_M_pop_front_aux() (deque.tcc:583)
==3972973==    by 0x110B0D: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1585)
==3972973==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972973==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973== 
==3972973== This conflicts with a previous read of size 8 by thread #10
==3972973== Locks held: none
==3972973==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972973==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972973==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972973==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==  Address 0x1ffefff070 is on thread #1's stack
==3972973==  in frame #6, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== ---Thread-Announcement------------------------------------------
==3972973== 
==3972973== Thread #8 was created
==3972973==    at 0x4C3FA23: clone (clone.S:76)
==3972973==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972973==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972973==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972973==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972973==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972973==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972973==    by 0x115349: test_schedule_from_multiple_threads() (test_custom.cc:322)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973== 
==3972973== ----------------------------------------------------------------
==3972973== 
==3972973==  Lock at 0x1FFEFFF038 was first observed
==3972973==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972973==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972973==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972973==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972973==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972973==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972973==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972973==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972973==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972973==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972973==  Address 0x1ffefff038 is on thread #1's stack
==3972973==  in frame #1, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972973== Locks held: 1, at address 0x1FFEFFF038
==3972973==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972973==    by 0x11547A: test_schedule_from_multiple_threads() (test_custom.cc:336)
==3972973==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972973==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972973==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972973==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972973==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972973==    by 0x119D91: main (test_custom.cc:942)
==3972973== 
==3972973== This conflicts with a previous read of size 1 by thread #8
==3972973== Locks held: none
==3972973==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972973==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972973==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972973==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972973==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972973==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972973==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972973==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972973==  Address 0x1ffefff030 is on thread #1's stack
==3972973==  in frame #1, created by test_schedule_from_multiple_threads() (test_custom.cc:318)
==3972973== 
==3972973== 
==3972973== Use --history-level=approx or =none to gain increased speed, at
==3972973== the cost of reduced accuracy of conflicting-access information
==3972973== For lists of detected and suppressed errors, rerun with: -s
==3972973== ERROR SUMMARY: 15952 errors from 11 contexts (suppressed: 601730 from 19)
[1;31m❌ FAILED[0m
[34m[F02][0m Schedule after destruction (invalid use)... ==3972988== 
==3972988== Use --history-level=approx or =none to gain increased speed, at
==3972988== the cost of reduced accuracy of conflicting-access information
==3972988== For lists of detected and suppressed errors, rerun with: -s
==3972988== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 136 from 19)
[1;32m✅ PASSED[0m
[34m[F03][0m Schedule inside another task... ==3972992== ---Thread-Announcement------------------------------------------
==3972992== 
==3972992== Thread #2 was created
==3972992==    at 0x4C3FA23: clone (clone.S:76)
==3972992==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972992==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972992==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972992==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972992==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3972992==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992== 
==3972992== ---Thread-Announcement------------------------------------------
==3972992== 
==3972992== Thread #3 was created
==3972992==    at 0x4C3FA23: clone (clone.S:76)
==3972992==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3972992==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3972992==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3972992==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3972992==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3972992==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992== 
==3972992== ---Thread-Announcement------------------------------------------
==3972992== 
==3972992== Thread #1 is the program's root thread
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972992==    by 0x4C3FA33: clone (clone.S:100)
==3972992== 
==3972992== This conflicts with a previous write of size 1 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972992==    by 0x4C3FA33: clone (clone.S:100)
==3972992== 
==3972992== This conflicts with a previous write of size 1 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3972992==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3972992==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972992==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992== 
==3972992== This conflicts with a previous read of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x12407C: std::_Function_base::_Base_manager<test_schedule_inside_task()::{lambda()#1}>::_M_destroy(std::_Any_data&, std::integral_constant<bool, false>) (std_function.h:175)
==3972992==    by 0x1218D5: std::_Function_base::_Base_manager<test_schedule_inside_task()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:203)
==3972992==    by 0x11DD41: std::_Function_handler<void (), test_schedule_inside_task()::{lambda()#1}>::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (std_function.h:282)
==3972992==    by 0x10FF4C: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:505)
==3972992==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==  Address 0x4e28598 is 8 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3972992==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972992==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972992==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992== 
==3972992== This conflicts with a previous write of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972992==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3972992==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3972992==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972992==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992== 
==3972992== This conflicts with a previous write of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3972992==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3972992==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972992==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972992==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992== 
==3972992== This conflicts with a previous write of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972992==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3972992==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3972992==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3972992==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992== 
==3972992== This conflicts with a previous write of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3972992==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3972992==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3972992==    by 0x111AD6: allocate (alloc_traits.h:482)
==3972992==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3972992==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3972992==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3972992==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3972992==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3972992==    by 0x1157A2: test_schedule_inside_task() (test_custom.cc:361)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==  Block was alloc'd by thread #1
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3972992==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3972992==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3972992== 
==3972992== This conflicts with a previous read of size 8 by thread #3
==3972992== Locks held: none
==3972992==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3972992==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3972992==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3972992==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==  Address 0x1ffefff070 is on thread #1's stack
==3972992==  in frame #3, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== ----------------------------------------------------------------
==3972992== 
==3972992==  Lock at 0x1FFEFFF038 was first observed
==3972992==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3972992==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3972992==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3972992==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3972992==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3972992==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3972992==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3972992==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3972992==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3972992==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3972992==  Address 0x1ffefff038 is on thread #1's stack
==3972992==  in frame #1, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3972992== Locks held: 1, at address 0x1FFEFFF038
==3972992==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3972992==    by 0x1158DE: test_schedule_inside_task() (test_custom.cc:381)
==3972992==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3972992==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3972992==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3972992==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3972992==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3972992==    by 0x119D91: main (test_custom.cc:942)
==3972992== 
==3972992== This conflicts with a previous read of size 1 by thread #3
==3972992== Locks held: none
==3972992==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3972992==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3972992==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3972992==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3972992==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3972992==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3972992==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3972992==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3972992==  Address 0x1ffefff030 is on thread #1's stack
==3972992==  in frame #1, created by test_schedule_inside_task() (test_custom.cc:360)
==3972992== 
==3972992== 
==3972992== Use --history-level=approx or =none to gain increased speed, at
==3972992== the cost of reduced accuracy of conflicting-access information
==3972992== For lists of detected and suppressed errors, rerun with: -s
==3972992== ERROR SUMMARY: 9 errors from 9 contexts (suppressed: 208 from 18)
[1;31m❌ FAILED[0m
[34m[F04][0m Wait blocks until all tasks finish... ==3972998== 
==3972998== Use --history-level=approx or =none to gain increased speed, at
==3972998== the cost of reduced accuracy of conflicting-access information
==3972998== For lists of detected and suppressed errors, rerun with: -s
==3972998== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 136 from 19)
[1;32m✅ PASSED[0m
[34m[F06][0m Many waits in parallel... ==3973002== ---Thread-Announcement------------------------------------------
==3973002== 
==3973002== Thread #5 was created
==3973002==    at 0x4C3FA23: clone (clone.S:76)
==3973002==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973002==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973002==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973002==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973002==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973002==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002== 
==3973002== ---Thread-Announcement------------------------------------------
==3973002== 
==3973002== Thread #2 was created
==3973002==    at 0x4C3FA23: clone (clone.S:76)
==3973002==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973002==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973002==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973002==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973002==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973002==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002== 
==3973002== ---Thread-Announcement------------------------------------------
==3973002== 
==3973002== Thread #1 is the program's root thread
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 1 at 0x4E28768 by thread #5
==3973002== Locks held: none
==3973002==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973002==    by 0x4C3FA33: clone (clone.S:100)
==3973002== 
==3973002== This conflicts with a previous read of size 1 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==  Address 0x4e28768 is 472 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ---Thread-Announcement------------------------------------------
==3973002== 
==3973002== Thread #3 was created
==3973002==    at 0x4C3FA23: clone (clone.S:76)
==3973002==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973002==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973002==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973002==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973002==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973002==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #3
==3973002== Locks held: none
==3973002==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973002==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973002==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973002==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous write of size 8 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973002==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973002==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==  Address 0x1ffefff070 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973002==    by 0x4C3FA33: clone (clone.S:100)
==3973002== 
==3973002== This conflicts with a previous write of size 1 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973002==    by 0x4C3FA33: clone (clone.S:100)
==3973002== 
==3973002== This conflicts with a previous write of size 1 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3973002==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3973002==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973002==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous read of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x115AB8: test_many_waits_during_execution()::{lambda()#1}::operator()() const (test_custom.cc:408)
==3973002==    by 0x12418B: void std::__invoke_impl<void, test_many_waits_during_execution()::{lambda()#1}&>(std::__invoke_other, test_many_waits_during_execution()::{lambda()#1}&) (invoke.h:61)
==3973002==    by 0x121ACE: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_many_waits_during_execution()::{lambda()#1}&>(test_many_waits_during_execution()::{lambda()#1}&) (invoke.h:150)
==3973002==    by 0x11DEB2: std::_Function_handler<void (), test_many_waits_during_execution()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3973002==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==  Address 0x4e28598 is 8 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973002==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973002==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973002==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous write of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973002==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973002==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973002==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973002==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous write of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973002==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973002==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973002==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973002==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous write of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973002==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973002==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973002==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973002==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002== 
==3973002== This conflicts with a previous write of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973002==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973002==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973002==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973002==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973002==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973002==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973002==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973002==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==  Block was alloc'd by thread #1
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973002==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973002==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973002== 
==3973002== This conflicts with a previous read of size 8 by thread #3
==3973002== Locks held: none
==3973002==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973002==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973002==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973002==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==  Address 0x1ffefff070 is on thread #1's stack
==3973002==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== ---Thread-Announcement------------------------------------------
==3973002== 
==3973002== Thread #4 was created
==3973002==    at 0x4C3FA23: clone (clone.S:76)
==3973002==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973002==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973002==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973002==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973002==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973002==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973002==    by 0x115BA7: test_many_waits_during_execution() (test_custom.cc:402)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002== 
==3973002== ----------------------------------------------------------------
==3973002== 
==3973002==  Lock at 0x1FFEFFF038 was first observed
==3973002==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973002==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973002==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973002==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973002==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973002==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973002==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973002==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973002==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973002==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973002==  Address 0x1ffefff038 is on thread #1's stack
==3973002==  in frame #1, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3973002== Locks held: 1, at address 0x1FFEFFF038
==3973002==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973002==    by 0x115EC6: test_many_waits_during_execution() (test_custom.cc:440)
==3973002==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973002==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973002==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973002==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973002==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973002==    by 0x119D91: main (test_custom.cc:942)
==3973002== 
==3973002== This conflicts with a previous read of size 1 by thread #4
==3973002== Locks held: none
==3973002==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973002==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973002==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973002==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973002==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973002==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973002==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973002==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973002==  Address 0x1ffefff030 is on thread #1's stack
==3973002==  in frame #1, created by test_many_waits_during_execution() (test_custom.cc:400)
==3973002== 
==3973002== 
==3973002== Use --history-level=approx or =none to gain increased speed, at
==3973002== the cost of reduced accuracy of conflicting-access information
==3973002== For lists of detected and suppressed errors, rerun with: -s
==3973002== ERROR SUMMARY: 389 errors from 11 contexts (suppressed: 86266 from 20)
[1;31m❌ FAILED[0m
[34m[F07][0m High contention on atomic counter... ==3973014== ---Thread-Announcement------------------------------------------
==3973014== 
==3973014== Thread #4 was created
==3973014==    at 0x4C3FA23: clone (clone.S:76)
==3973014==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973014==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973014==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973014==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973014==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973014==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014== 
==3973014== ---Thread-Announcement------------------------------------------
==3973014== 
==3973014== Thread #2 was created
==3973014==    at 0x4C3FA23: clone (clone.S:76)
==3973014==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973014==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973014==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973014==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973014==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973014==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014== 
==3973014== ---Thread-Announcement------------------------------------------
==3973014== 
==3973014== Thread #1 is the program's root thread
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 1 at 0x4E286C8 by thread #4
==3973014== Locks held: none
==3973014==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973014==    by 0x4C3FA33: clone (clone.S:100)
==3973014== 
==3973014== This conflicts with a previous read of size 1 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==  Address 0x4e286c8 is 312 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ---Thread-Announcement------------------------------------------
==3973014== 
==3973014== Thread #3 was created
==3973014==    at 0x4C3FA23: clone (clone.S:76)
==3973014==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973014==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973014==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973014==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973014==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973014==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973014==    by 0x4C3FA33: clone (clone.S:100)
==3973014== 
==3973014== This conflicts with a previous write of size 1 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973014==    by 0x4C3FA33: clone (clone.S:100)
==3973014== 
==3973014== This conflicts with a previous write of size 1 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3973014==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3973014==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973014==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous read of size 8 by thread #3
==3973014== Locks held: none
==3973014==    at 0x115F4C: test_high_contention_atomic_updates()::{lambda()#1}::operator()() const (test_custom.cc:453)
==3973014==    by 0x1244FB: void std::__invoke_impl<void, test_high_contention_atomic_updates()::{lambda()#1}&>(std::__invoke_other, test_high_contention_atomic_updates()::{lambda()#1}&) (invoke.h:61)
==3973014==    by 0x121C97: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_high_contention_atomic_updates()::{lambda()#1}&>(test_high_contention_atomic_updates()::{lambda()#1}&) (invoke.h:150)
==3973014==    by 0x11E4B4: std::_Function_handler<void (), test_high_contention_atomic_updates()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3973014==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==  Address 0x4e28598 is 8 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973014==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973014==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973014==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous write of size 8 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973014==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973014==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973014==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973014==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous write of size 8 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973014==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973014==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973014==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973014==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous write of size 8 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973014==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973014==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973014==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973014==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous write of size 8 by thread #3
==3973014== Locks held: none
==3973014==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973014==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973014==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973014==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973014==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973014==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973014==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973014==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973014==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973014==    by 0x115FA1: test_high_contention_atomic_updates() (test_custom.cc:447)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==  Block was alloc'd by thread #1
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #4
==3973014== Locks held: none
==3973014==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973014==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973014==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973014==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014== 
==3973014== This conflicts with a previous write of size 8 by thread #2
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973014==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973014==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==  Address 0x1ffefff070 is on thread #1's stack
==3973014==  in frame #6, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== ----------------------------------------------------------------
==3973014== 
==3973014==  Lock at 0x1FFEFFF038 was first observed
==3973014==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973014==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973014==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973014==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973014==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973014==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973014==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973014==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973014==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973014==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973014==  Address 0x1ffefff038 is on thread #1's stack
==3973014==  in frame #1, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3973014== Locks held: 1, at address 0x1FFEFFF038
==3973014==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973014==    by 0x11604E: test_high_contention_atomic_updates() (test_custom.cc:458)
==3973014==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973014==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973014==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973014==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973014==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973014==    by 0x119D91: main (test_custom.cc:942)
==3973014== 
==3973014== This conflicts with a previous read of size 1 by thread #4
==3973014== Locks held: none
==3973014==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973014==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973014==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973014==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973014==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973014==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973014==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973014==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973014==  Address 0x1ffefff030 is on thread #1's stack
==3973014==  in frame #1, created by test_high_contention_atomic_updates() (test_custom.cc:445)
==3973014== 
==3973014== 
==3973014== Use --history-level=approx or =none to gain increased speed, at
==3973014== the cost of reduced accuracy of conflicting-access information
==3973014== For lists of detected and suppressed errors, rerun with: -s
==3973014== ERROR SUMMARY: 7972 errors from 10 contexts (suppressed: 933451 from 19)
[1;31m❌ FAILED[0m
[34m[F08][0m Destroy pool immediately after scheduling... ==3973022== ---Thread-Announcement------------------------------------------
==3973022== 
==3973022== Thread #4 was created
==3973022==    at 0x4C3FA23: clone (clone.S:76)
==3973022==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973022==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973022==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973022==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973022==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973022==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022== 
==3973022== ---Thread-Announcement------------------------------------------
==3973022== 
==3973022== Thread #2 was created
==3973022==    at 0x4C3FA23: clone (clone.S:76)
==3973022==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973022==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973022==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973022==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973022==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973022==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022== 
==3973022== ---Thread-Announcement------------------------------------------
==3973022== 
==3973022== Thread #1 is the program's root thread
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 1 at 0x4E28838 by thread #4
==3973022== Locks held: none
==3973022==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973022==    by 0x4C3FA33: clone (clone.S:100)
==3973022== 
==3973022== This conflicts with a previous read of size 1 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==  Address 0x4e28838 is 312 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ---Thread-Announcement------------------------------------------
==3973022== 
==3973022== Thread #3 was created
==3973022==    at 0x4C3FA23: clone (clone.S:76)
==3973022==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973022==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973022==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973022==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973022==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973022==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during read of size 8 at 0x4E285F0 by thread #3
==3973022== Locks held: none
==3973022==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973022==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973022==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973022==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022== 
==3973022== This conflicts with a previous write of size 8 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973022==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973022==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==  Address 0x4e285f0 is 96 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during read of size 1 at 0x4E28798 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973022==    by 0x4C3FA33: clone (clone.S:100)
==3973022== 
==3973022== This conflicts with a previous write of size 1 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==  Address 0x4e28798 is 152 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 1 at 0x4E28798 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973022==    by 0x4C3FA33: clone (clone.S:100)
==3973022== 
==3973022== This conflicts with a previous write of size 1 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==  Address 0x4e28798 is 152 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during read of size 8 at 0x4E28718 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973022==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973022==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973022==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022== 
==3973022== This conflicts with a previous write of size 8 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973022==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e28718 is 24 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 8 at 0x4E28718 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973022==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973022==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973022==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022== 
==3973022== This conflicts with a previous write of size 8 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973022==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e28718 is 24 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during read of size 8 at 0x4E28720 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973022==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973022==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973022==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022== 
==3973022== This conflicts with a previous write of size 8 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973022==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e28720 is 32 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 8 at 0x4E28720 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973022==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973022==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973022==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022== 
==3973022== This conflicts with a previous write of size 8 by thread #3
==3973022== Locks held: none
==3973022==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973022==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e28720 is 32 bytes inside a block of size 320 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973022==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973022==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973022==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973022==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973022==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973022==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973022==    by 0x116110: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 8 at 0x4E285F0 by thread #2
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973022==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973022==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973022== 
==3973022== This conflicts with a previous read of size 8 by thread #3
==3973022== Locks held: none
==3973022==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973022==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973022==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973022==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==  Address 0x4e285f0 is 96 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== ----------------------------------------------------------------
==3973022== 
==3973022==  Lock at 0x4E285B8 was first observed
==3973022==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973022==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973022==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973022==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973022==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973022==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973022==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973022==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973022==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973022==  Address 0x4e285b8 is 40 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== Possible data race during write of size 1 at 0x4E285B0 by thread #1
==3973022== Locks held: 1, at address 0x4E285B8
==3973022==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973022==    by 0x11616A: test_immediate_destruction_after_schedule() (test_custom.cc:471)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022== 
==3973022== This conflicts with a previous read of size 1 by thread #4
==3973022== Locks held: none
==3973022==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973022==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973022==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973022==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973022==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973022==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973022==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973022==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973022==  Address 0x4e285b0 is 32 bytes inside a block of size 304 alloc'd
==3973022==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973022==    by 0x1160FA: test_immediate_destruction_after_schedule() (test_custom.cc:465)
==3973022==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973022==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973022==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973022==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973022==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973022==    by 0x119D91: main (test_custom.cc:942)
==3973022==  Block was alloc'd by thread #1
==3973022== 
==3973022== 
==3973022== Use --history-level=approx or =none to gain increased speed, at
==3973022== the cost of reduced accuracy of conflicting-access information
==3973022== For lists of detected and suppressed errors, rerun with: -s
==3973022== ERROR SUMMARY: 64 errors from 10 contexts (suppressed: 63417 from 19)
[1;31m❌ FAILED[0m
[34m[F09][0m Interleaved schedule/wait execution... ==3973026== ---Thread-Announcement------------------------------------------
==3973026== 
==3973026== Thread #4 was created
==3973026==    at 0x4C3FA23: clone (clone.S:76)
==3973026==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973026==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973026==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973026==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973026==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973026==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026== 
==3973026== ---Thread-Announcement------------------------------------------
==3973026== 
==3973026== Thread #3 was created
==3973026==    at 0x4C3FA23: clone (clone.S:76)
==3973026==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973026==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973026==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973026==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973026==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973026==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026== 
==3973026== ---Thread-Announcement------------------------------------------
==3973026== 
==3973026== Thread #2 was created
==3973026==    at 0x4C3FA23: clone (clone.S:76)
==3973026==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973026==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973026==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973026==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973026==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x11B6F6: std::thread::thread<test_massive_schedule_wait_interleave()::{lambda()#1}, , void>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (std_thread.h:164)
==3973026==    by 0x1163F2: test_massive_schedule_wait_interleave() (test_custom.cc:498)
==3973026==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973026==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973026==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973026==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 1 at 0x4E287F8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026==    by 0x4C3FA33: clone (clone.S:100)
==3973026== 
==3973026== This conflicts with a previous read of size 1 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==  Address 0x4e287f8 is 152 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during read of size 1 at 0x4E287F8 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026==    by 0x4C3FA33: clone (clone.S:100)
==3973026== 
==3973026== This conflicts with a previous write of size 1 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==  Address 0x4e287f8 is 152 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 1 at 0x4E287F8 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026==    by 0x4C3FA33: clone (clone.S:100)
==3973026== 
==3973026== This conflicts with a previous write of size 1 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==  Address 0x4e287f8 is 152 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 8 at 0x4E28768 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3973026==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3973026==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973026==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous read of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x1161FE: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}::operator()() const (test_custom.cc:488)
==3973026==    by 0x124647: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}&>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:61)
==3973026==    by 0x121F3A: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}&>(test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:150)
==3973026==    by 0x11E69C: std::_Function_handler<void (), test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973026==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3973026==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==  Address 0x4e28768 is 8 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during read of size 8 at 0x4E28778 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973026==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973026==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973026==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous write of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973026==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x4e28778 is 24 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 8 at 0x4E28778 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973026==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973026==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973026==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous write of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973026==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x4e28778 is 24 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during read of size 8 at 0x4E28780 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973026==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973026==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973026==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous write of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973026==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x4e28780 is 32 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 8 at 0x4E28780 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973026==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973026==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973026==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous write of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973026==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x4e28780 is 32 bytes inside a block of size 320 alloc'd
==3973026==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973026==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973026==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973026==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973026==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973026==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973026==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Block was alloc'd by thread #2
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 8 at 0x5A15CA0 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973026==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973026==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026== 
==3973026== This conflicts with a previous read of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973026==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973026==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973026==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==  Address 0x5a15ca0 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #3, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 8 at 0x5A15CC0 by thread #2
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x110BCD: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::push_back(std::function<void ()> const&) (stl_deque.h:1545)
==3973026==    by 0x11003C: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::push(std::function<void ()> const&) (stl_queue.h:286)
==3973026==    by 0x10E3B0: ThreadPool::schedule(std::function<void ()> const&) (thread-pool.cc:79)
==3973026==    by 0x116299: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:486)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x127069: std::thread::_State_impl<std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026== 
==3973026== This conflicts with a previous read of size 8 by thread #4
==3973026== Locks held: none
==3973026==    at 0x1113F3: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973026==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973026==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973026==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==  Address 0x5a15cc0 is on thread #2's stack
==3973026==  in frame #3, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== ---Thread-Announcement------------------------------------------
==3973026== 
==3973026== Thread #5 was created
==3973026==    at 0x4C3FA23: clone (clone.S:76)
==3973026==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973026==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973026==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973026==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973026==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973026==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973026==    by 0x116247: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:484)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during read of size 8 at 0x5A15CA0 by thread #5
==3973026== Locks held: none
==3973026==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973026==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973026==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973026==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026== 
==3973026== This conflicts with a previous write of size 8 by thread #3
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973026==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973026==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==  Address 0x5a15ca0 is on thread #2's stack
==3973026==  in frame #6, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== ----------------------------------------------------------------
==3973026== 
==3973026==  Lock at 0x5A15C68 was first observed
==3973026==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973026==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973026==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973026==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973026==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973026==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973026==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==  Address 0x5a15c68 is on thread #2's stack
==3973026==  in frame #1, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== Possible data race during write of size 1 at 0x5A15C60 by thread #2
==3973026== Locks held: 1, at address 0x5A15C68
==3973026==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973026==    by 0x11632F: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:495)
==3973026==    by 0x127A70: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==3973026==    by 0x12777E: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==3973026==    by 0x1273C1: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x1271C1: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973026==    by 0x127069: std::thread::_State_impl<std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973026==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973026==    by 0x4C3FA33: clone (clone.S:100)
==3973026== 
==3973026== This conflicts with a previous read of size 1 by thread #5
==3973026== Locks held: none
==3973026==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973026==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973026==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973026==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973026==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973026==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973026==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973026==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973026==  Address 0x5a15c60 is on thread #2's stack
==3973026==  in frame #1, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:482)
==3973026== 
==3973026== 
==3973026== Use --history-level=approx or =none to gain increased speed, at
==3973026== the cost of reduced accuracy of conflicting-access information
==3973026== For lists of detected and suppressed errors, rerun with: -s
==3973026== ERROR SUMMARY: 325 errors from 12 contexts (suppressed: 116602 from 25)
[1;31m❌ FAILED[0m
[34m[F10][0m Multiple schedule/wait rounds... ==3973031== 
==3973031== Use --history-level=approx or =none to gain increased speed, at
==3973031== the cost of reduced accuracy of conflicting-access information
==3973031== For lists of detected and suppressed errors, rerun with: -s
==3973031== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[34m[F11][0m Multiple wait() calls inside tasks... ==3973032== 
==3973032== Use --history-level=approx or =none to gain increased speed, at
==3973032== the cost of reduced accuracy of conflicting-access information
==3973032== For lists of detected and suppressed errors, rerun with: -s
==3973032== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[34m[F12][0m Concurrent schedule/wait in parallel... ==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #5 was created
==3973033==    at 0x4C3FA23: clone (clone.S:76)
==3973033==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973033==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973033==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973033==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973033==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973033==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033== 
==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #2 was created
==3973033==    at 0x4C3FA23: clone (clone.S:76)
==3973033==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973033==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973033==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973033==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973033==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973033==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033== 
==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #1 is the program's root thread
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 1 at 0x4E28768 by thread #5
==3973033== Locks held: none
==3973033==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973033==    by 0x4C3FA33: clone (clone.S:100)
==3973033== 
==3973033== This conflicts with a previous read of size 1 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==  Address 0x4e28768 is 472 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #3 was created
==3973033==    at 0x4C3FA23: clone (clone.S:76)
==3973033==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973033==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973033==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973033==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973033==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973033==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during read of size 1 at 0x4E28628 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973033==    by 0x4C3FA33: clone (clone.S:100)
==3973033== 
==3973033== This conflicts with a previous write of size 1 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 1 at 0x4E28628 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973033==    by 0x4C3FA33: clone (clone.S:100)
==3973033== 
==3973033== This conflicts with a previous write of size 1 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 8 at 0x4E28598 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3973033==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3973033==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973033==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous read of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x116B0B: test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}::operator()() const (test_custom.cc:597)
==3973033==    by 0x1248D5: void std::__invoke_impl<void, test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}&>(std::__invoke_other, test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:61)
==3973033==    by 0x1223DD: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}&>(test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}&) (invoke.h:150)
==3973033==    by 0x11EAF3: std::_Function_handler<void (), test_concurrent_schedule_wait_parallel()::{lambda()#1}::operator()() const::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3973033==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==  Address 0x4e28598 is 8 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during read of size 8 at 0x4E285A8 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973033==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973033==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973033==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous write of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973033==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 8 at 0x4E285A8 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973033==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973033==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973033==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous write of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973033==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x4e285a8 is 24 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during read of size 8 at 0x4E285B0 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973033==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973033==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973033==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous write of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973033==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 8 at 0x4E285B0 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973033==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973033==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973033==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous write of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973033==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x4e285b0 is 32 bytes inside a block of size 640 alloc'd
==3973033==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973033==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973033==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973033==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973033==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973033==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973033==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==  Block was alloc'd by thread #1
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #3
==3973033== Locks held: none
==3973033==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973033==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973033==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973033==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous write of size 8 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973033==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973033==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==  Address 0x1ffefff070 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973033==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973033==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973033== 
==3973033== This conflicts with a previous read of size 8 by thread #3
==3973033== Locks held: none
==3973033==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973033==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973033==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973033==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==  Address 0x1ffefff070 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #4 was created
==3973033==    at 0x4C3FA23: clone (clone.S:76)
==3973033==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973033==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973033==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973033==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973033==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973033==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #2
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x111773: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::_M_pop_front_aux() (deque.tcc:583)
==3973033==    by 0x110B0D: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1585)
==3973033==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973033==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033== 
==3973033== This conflicts with a previous read of size 8 by thread #4
==3973033== Locks held: none
==3973033==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973033==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973033==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973033==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==  Address 0x1ffefff070 is on thread #1's stack
==3973033==  in frame #6, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== ---Thread-Announcement------------------------------------------
==3973033== 
==3973033== Thread #6 was created
==3973033==    at 0x4C3FA23: clone (clone.S:76)
==3973033==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973033==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973033==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973033==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973033==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973033==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973033==    by 0x116C9E: test_concurrent_schedule_wait_parallel() (test_custom.cc:589)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033== 
==3973033== ----------------------------------------------------------------
==3973033== 
==3973033==  Lock at 0x1FFEFFF038 was first observed
==3973033==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973033==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973033==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973033==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973033==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973033==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973033==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973033==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973033==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973033==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973033==  Address 0x1ffefff038 is on thread #1's stack
==3973033==  in frame #1, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3973033== Locks held: 1, at address 0x1FFEFFF038
==3973033==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973033==    by 0x116F44: test_concurrent_schedule_wait_parallel() (test_custom.cc:621)
==3973033==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973033==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973033==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973033==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973033==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973033==    by 0x119D91: main (test_custom.cc:942)
==3973033== 
==3973033== This conflicts with a previous read of size 1 by thread #6
==3973033== Locks held: none
==3973033==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973033==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973033==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973033==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973033==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973033==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973033==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973033==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973033==  Address 0x1ffefff030 is on thread #1's stack
==3973033==  in frame #1, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:582)
==3973033== 
==3973033== 
==3973033== Use --history-level=approx or =none to gain increased speed, at
==3973033== the cost of reduced accuracy of conflicting-access information
==3973033== For lists of detected and suppressed errors, rerun with: -s
==3973033== ERROR SUMMARY: 1587 errors from 12 contexts (suppressed: 172881 from 20)
[1;31m❌ FAILED[0m
[31m[H01][0m Wait inside task should deadlock... ==3973046== 
==3973046== Use --history-level=approx or =none to gain increased speed, at
==3973046== the cost of reduced accuracy of conflicting-access information
==3973046== For lists of detected and suppressed errors, rerun with: -s
==3973046== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[33m[L01][0m Destructor waits for tasks completion... ==3973047== 
==3973047== Use --history-level=approx or =none to gain increased speed, at
==3973047== the cost of reduced accuracy of conflicting-access information
==3973047== For lists of detected and suppressed errors, rerun with: -s
==3973047== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 111 from 19)
[1;32m✅ PASSED[0m
[33m[L02][0m Repeated pool creation and destruction... ==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #4 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973050==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #2 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973050==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #1 is the program's root thread
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 1 at 0x4E286C8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973050==    by 0x4C3FA33: clone (clone.S:100)
==3973050== 
==3973050== This conflicts with a previous read of size 1 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during read of size 1 at 0x4E286C8 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973050==    by 0x4C3FA33: clone (clone.S:100)
==3973050== 
==3973050== This conflicts with a previous write of size 1 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 1 at 0x4E286C8 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973050==    by 0x4C3FA33: clone (clone.S:100)
==3973050== 
==3973050== This conflicts with a previous write of size 1 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==  Address 0x4e286c8 is 312 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 8 at 0x4E28638 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x1115D6: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<std::_Any_data> >, std::is_move_constructible<std::_Any_data>, std::is_move_assignable<std::_Any_data> >::value, void>::type std::swap<std::_Any_data>(std::_Any_data&, std::_Any_data&) (move.h:199)
==3973050==    by 0x110A4E: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:558)
==3973050==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973050==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous read of size 8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x117136: test_repeated_pool_creation()::{lambda()#1}::operator()() const (test_custom.cc:651)
==3973050==    by 0x124C21: void std::__invoke_impl<void, test_repeated_pool_creation()::{lambda()#1}&>(std::__invoke_other, test_repeated_pool_creation()::{lambda()#1}&) (invoke.h:61)
==3973050==    by 0x122680: std::enable_if<std::is_void<void>::value, void>::type std::__invoke_r<void, test_repeated_pool_creation()::{lambda()#1}&>(test_repeated_pool_creation()::{lambda()#1}&) (invoke.h:150)
==3973050==    by 0x11F6A2: std::_Function_handler<void (), test_repeated_pool_creation()::{lambda()#1}>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x10FF09: std::function<void ()>::operator()() const (std_function.h:591)
==3973050==    by 0x10E1DD: ThreadPool::worker(int) (thread-pool.cc:60)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==  Address 0x4e28638 is 168 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during read of size 8 at 0x4E28648 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973050==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973050==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973050==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous write of size 8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973050==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x4e28648 is 184 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 8 at 0x4E28648 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973050==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973050==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973050==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous write of size 8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973050==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x4e28648 is 184 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during read of size 8 at 0x4E28650 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973050==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973050==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973050==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous write of size 8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973050==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x4e28650 is 192 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 8 at 0x4E28650 by thread #2
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973050==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973050==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973050==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous write of size 8 by thread #4
==3973050== Locks held: none
==3973050==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973050==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x4e28650 is 192 bytes inside a block of size 320 alloc'd
==3973050==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973050==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973050==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973050==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973050==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973050==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973050==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==  Block was alloc'd by thread #1
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #3 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973050==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #1, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973050==    by 0x117264: test_repeated_pool_creation() (test_custom.cc:656)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973050==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973050==    by 0x119D91: main (test_custom.cc:942)
==3973050== 
==3973050== This conflicts with a previous read of size 1 by thread #3
==3973050== Locks held: none
==3973050==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==  Address 0x1ffefff030 is on thread #1's stack
==3973050==  in frame #1, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #5 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973050==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #6 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973050==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during write of size 8 at 0x1FFEFFF070 by thread #5
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973050==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973050==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973050== 
==3973050== This conflicts with a previous read of size 8 by thread #6
==3973050== Locks held: none
==3973050==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973050==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973050==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973050==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==  Address 0x1ffefff070 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #18 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973050==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ---Thread-Announcement------------------------------------------
==3973050== 
==3973050== Thread #17 was created
==3973050==    at 0x4C3FA23: clone (clone.S:76)
==3973050==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973050==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973050==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973050==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973050==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973050==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973050==    by 0x1171A6: test_repeated_pool_creation() (test_custom.cc:647)
==3973050==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973050==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973050==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973050== 
==3973050== ----------------------------------------------------------------
==3973050== 
==3973050==  Lock at 0x1FFEFFF038 was first observed
==3973050==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973050==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973050==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973050==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973050==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973050==  Address 0x1ffefff038 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== Possible data race during read of size 8 at 0x1FFEFFF070 by thread #18
==3973050== Locks held: none
==3973050==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973050==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973050==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973050==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973050==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973050==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973050==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973050==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973050==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973050==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973050==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973050== 
==3973050== This conflicts with a previous write of size 8 by thread #17
==3973050== Locks held: 1, at address 0x1FFEFFF038
==3973050==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973050==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973050==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973050==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973050==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973050==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973050==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973050==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973050==  Address 0x1ffefff070 is on thread #1's stack
==3973050==  in frame #6, created by test_repeated_pool_creation() (test_custom.cc:643)
==3973050== 
==3973050== 
==3973050== Use --history-level=approx or =none to gain increased speed, at
==3973050== the cost of reduced accuracy of conflicting-access information
==3973050== For lists of detected and suppressed errors, rerun with: -s
==3973050== ERROR SUMMARY: 6660 errors from 11 contexts (suppressed: 1176784 from 19)
[1;31m❌ FAILED[0m
[91m[M01][0m Schedule nullptr function... ==3973354== 
==3973354== Use --history-level=approx or =none to gain increased speed, at
==3973354== the cost of reduced accuracy of conflicting-access information
==3973354== For lists of detected and suppressed errors, rerun with: -s
==3973354== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 64 from 16)
[1;32m✅ PASSED[0m
[91m[M02][0m wait() during infinite rescheduling... ==3973358== 
==3973358== Use --history-level=approx or =none to gain increased speed, at
==3973358== the cost of reduced accuracy of conflicting-access information
==3973358== For lists of detected and suppressed errors, rerun with: -s
==3973358== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[96m[N01][0m Deep nested task scheduling... ==3973359== ---Thread-Announcement------------------------------------------
==3973359== 
==3973359== Thread #3 was created
==3973359==    at 0x4C3FA23: clone (clone.S:76)
==3973359==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973359==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973359==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973359==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973359==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973359==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359== 
==3973359== ---Thread-Announcement------------------------------------------
==3973359== 
==3973359== Thread #4 was created
==3973359==    at 0x4C3FA23: clone (clone.S:76)
==3973359==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973359==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973359==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973359==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973359==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973359==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359== 
==3973359== ---Thread-Announcement------------------------------------------
==3973359== 
==3973359== Thread #2 was created
==3973359==    at 0x4C3FA23: clone (clone.S:76)
==3973359==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973359==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973359==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973359==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973359==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x11C07A: std::thread::thread<test_deep_nested_scheduling()::{lambda()#1}, , void>(test_deep_nested_scheduling()::{lambda()#1}&&) (std_thread.h:164)
==3973359==    by 0x1176A0: test_deep_nested_scheduling() (test_custom.cc:689)
==3973359==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973359==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973359==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973359==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during read of size 1 at 0x4E288B8 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973359==    by 0x4C3FA33: clone (clone.S:100)
==3973359== 
==3973359== This conflicts with a previous write of size 1 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==  Address 0x4e288b8 is 152 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during write of size 1 at 0x4E288B8 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973359==    by 0x4C3FA33: clone (clone.S:100)
==3973359== 
==3973359== This conflicts with a previous write of size 1 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==  Address 0x4e288b8 is 152 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during read of size 8 at 0x4E28838 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973359==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973359==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973359==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359== 
==3973359== This conflicts with a previous write of size 8 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973359==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x4e28838 is 24 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during write of size 8 at 0x4E28838 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973359==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973359==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973359==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359== 
==3973359== This conflicts with a previous write of size 8 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973359==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x4e28838 is 24 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during read of size 8 at 0x4E28840 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973359==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973359==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973359==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359== 
==3973359== This conflicts with a previous write of size 8 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973359==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x4e28840 is 32 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during write of size 8 at 0x4E28840 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973359==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973359==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973359==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359== 
==3973359== This conflicts with a previous write of size 8 by thread #4
==3973359== Locks held: none
==3973359==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973359==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x4e28840 is 32 bytes inside a block of size 640 alloc'd
==3973359==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973359==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973359==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973359==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973359==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973359==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973359==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973359==    by 0x1174DB: test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:673)
==3973359==    by 0x1279B9: void std::__invoke_impl<void, test_deep_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x127685: std::__invoke_result<test_deep_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_deep_nested_scheduling()::{lambda()#1}>(test_deep_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x12733D: void std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x12716D: std::thread::_Invoker<std::tuple<test_deep_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==  Block was alloc'd by thread #2
==3973359== 
==3973359== ----------------------------------------------------------------
==3973359== 
==3973359==  Lock at 0x5A15C68 was first observed
==3973359==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973359==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973359==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973359==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973359==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==  Address 0x5a15c68 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== Possible data race during write of size 8 at 0x5A15CA0 by thread #3
==3973359== Locks held: 1, at address 0x5A15C68
==3973359==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973359==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973359==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973359==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973359==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973359==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973359==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973359==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973359==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973359==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973359==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973359== 
==3973359== This conflicts with a previous read of size 8 by thread #4
==3973359== Locks held: none
==3973359==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973359==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973359==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973359==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973359==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973359==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973359==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973359==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973359==  Address 0x5a15ca0 is on thread #2's stack
==3973359==  in frame #6, created by test_deep_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:671)
==3973359== 
==3973359== 
==3973359== Use --history-level=approx or =none to gain increased speed, at
==3973359== the cost of reduced accuracy of conflicting-access information
==3973359== For lists of detected and suppressed errors, rerun with: -s
==3973359== ERROR SUMMARY: 14 errors from 7 contexts (suppressed: 288 from 26)
[1;31m❌ FAILED[0m
[96m[N02][0m Extreme nested scheduling (1000)... ==3973366== ---Thread-Announcement------------------------------------------
==3973366== 
==3973366== Thread #3 was created
==3973366==    at 0x4C3FA23: clone (clone.S:76)
==3973366==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973366==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973366==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973366==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973366==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973366==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366== 
==3973366== ---Thread-Announcement------------------------------------------
==3973366== 
==3973366== Thread #4 was created
==3973366==    at 0x4C3FA23: clone (clone.S:76)
==3973366==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973366==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973366==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973366==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973366==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973366==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366== 
==3973366== ---Thread-Announcement------------------------------------------
==3973366== 
==3973366== Thread #2 was created
==3973366==    at 0x4C3FA23: clone (clone.S:76)
==3973366==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973366==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973366==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973366==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973366==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x11C2AE: std::thread::thread<test_extreme_nested_scheduling()::{lambda()#1}, , void>(test_extreme_nested_scheduling()::{lambda()#1}&&) (std_thread.h:164)
==3973366==    by 0x117B01: test_extreme_nested_scheduling() (test_custom.cc:727)
==3973366==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973366==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973366==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973366==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during read of size 1 at 0x4E288C8 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973366==    by 0x4C3FA33: clone (clone.S:100)
==3973366== 
==3973366== This conflicts with a previous write of size 1 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==  Address 0x4e288c8 is 152 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during write of size 1 at 0x4E288C8 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x10DFDC: ThreadPool::dispatcher() (thread-pool.cc:33)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973366==    by 0x4C3FA33: clone (clone.S:100)
==3973366== 
==3973366== This conflicts with a previous write of size 1 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==  Address 0x4e288c8 is 152 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during read of size 8 at 0x4E28848 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x111636: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:198)
==3973366==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973366==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973366==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366== 
==3973366== This conflicts with a previous write of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973366==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x4e28848 is 24 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during write of size 8 at 0x4E28848 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x111653: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >, std::is_move_constructible<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>, std::is_move_assignable<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)> >::value, void>::type std::swap<bool (*)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)>(bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation), bool (*&)(std::_Any_data&, std::_Any_data const&, std::_Manager_operation)) (move.h:199)
==3973366==    by 0x110A69: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:559)
==3973366==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973366==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366== 
==3973366== This conflicts with a previous write of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10FF51: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:506)
==3973366==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x4e28848 is 24 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during read of size 8 at 0x4E28850 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x1116AF: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:198)
==3973366==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973366==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973366==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366== 
==3973366== This conflicts with a previous write of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973366==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x4e28850 is 32 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during write of size 8 at 0x4E28850 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x1116CC: std::enable_if<std::__and_<std::__not_<std::__is_tuple_like<void (*)(std::_Any_data const&)> >, std::is_move_constructible<void (*)(std::_Any_data const&)>, std::is_move_assignable<void (*)(std::_Any_data const&)> >::value, void>::type std::swap<void (*)(std::_Any_data const&)>(void (*&)(std::_Any_data const&), void (*&)(std::_Any_data const&)) (move.h:199)
==3973366==    by 0x110A84: std::function<void ()>::swap(std::function<void ()>&) (std_function.h:560)
==3973366==    by 0x10FE36: std::function<void ()>::operator=(std::function<void ()> const&) (std_function.h:471)
==3973366==    by 0x10E078: ThreadPool::dispatcher() (thread-pool.cc:45)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366== 
==3973366== This conflicts with a previous write of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x10FF5D: std::function<void ()>::operator=(decltype(nullptr)) (std_function.h:507)
==3973366==    by 0x10E206: ThreadPool::worker(int) (thread-pool.cc:62)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x4e28850 is 32 bytes inside a block of size 640 alloc'd
==3973366==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973366==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973366==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973366==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973366==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973366==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973366==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973366==    by 0x11789B: test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:704)
==3973366==    by 0x12797C: void std::__invoke_impl<void, test_extreme_nested_scheduling()::{lambda()#1}>(std::__invoke_other, test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x127632: std::__invoke_result<test_extreme_nested_scheduling()::{lambda()#1}>::type std::__invoke<test_extreme_nested_scheduling()::{lambda()#1}>(test_extreme_nested_scheduling()::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x127311: void std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x127151: std::thread::_Invoker<std::tuple<test_extreme_nested_scheduling()::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==  Block was alloc'd by thread #2
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during write of size 8 at 0x5A15CA0 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x110AFC: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1582)
==3973366==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973366==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973366== 
==3973366== This conflicts with a previous read of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973366==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973366==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973366==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==  Address 0x5a15ca0 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== ----------------------------------------------------------------
==3973366== 
==3973366==  Lock at 0x5A15C68 was first observed
==3973366==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973366==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973366==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973366==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973366==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==  Address 0x5a15c68 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== Possible data race during write of size 8 at 0x5A15CA0 by thread #3
==3973366== Locks held: 1, at address 0x5A15C68
==3973366==    at 0x111773: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::_M_pop_front_aux() (deque.tcc:583)
==3973366==    by 0x110B0D: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::pop_front() (stl_deque.h:1585)
==3973366==    by 0x10FE79: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::pop() (stl_queue.h:321)
==3973366==    by 0x10E088: ThreadPool::dispatcher() (thread-pool.cc:46)
==3973366==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973366==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973366==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973366==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973366==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973366==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973366==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973366== 
==3973366== This conflicts with a previous read of size 8 by thread #4
==3973366== Locks held: none
==3973366==    at 0x1113FA: std::operator==(std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&, std::_Deque_iterator<std::function<void ()>, std::function<void ()>&, std::function<void ()>*> const&) (stl_deque.h:273)
==3973366==    by 0x110734: std::deque<std::function<void ()>, std::allocator<std::function<void ()> > >::empty() const (stl_deque.h:1348)
==3973366==    by 0x10FCD5: std::queue<std::function<void ()>, std::deque<std::function<void ()>, std::allocator<std::function<void ()> > > >::empty() const (stl_queue.h:219)
==3973366==    by 0x10E262: ThreadPool::worker(int) (thread-pool.cc:66)
==3973366==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973366==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973366==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973366==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973366==  Address 0x5a15ca0 is on thread #2's stack
==3973366==  in frame #6, created by test_extreme_nested_scheduling()::{lambda()#1}::operator()() const (test_custom.cc:702)
==3973366== 
==3973366== 
==3973366== Use --history-level=approx or =none to gain increased speed, at
==3973366== the cost of reduced accuracy of conflicting-access information
==3973366== For lists of detected and suppressed errors, rerun with: -s
==3973366== ERROR SUMMARY: 6993 errors from 8 contexts (suppressed: 52132 from 26)
[1;31m❌ FAILED[0m
[95m[T01][0m Parallel speedup benchmark (4 tasks)... ==3973373== ---Thread-Announcement------------------------------------------
==3973373== 
==3973373== Thread #3 was created
==3973373==    at 0x4C3FA23: clone (clone.S:76)
==3973373==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973373==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973373==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973373==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973373==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973373==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973373==    by 0x117C1B: test_parallel_speedup() (test_custom.cc:740)
==3973373==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973373==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973373==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973373== 
==3973373== ---Thread-Announcement------------------------------------------
==3973373== 
==3973373== Thread #2 was created
==3973373==    at 0x4C3FA23: clone (clone.S:76)
==3973373==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973373==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973373==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973373==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973373==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==    by 0x10E796: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (std_thread.h:164)
==3973373==    by 0x10DD52: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:12)
==3973373==    by 0x117C1B: test_parallel_speedup() (test_custom.cc:740)
==3973373==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973373==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973373==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973373== 
==3973373== ---Thread-Announcement------------------------------------------
==3973373== 
==3973373== Thread #1 is the program's root thread
==3973373== 
==3973373== ----------------------------------------------------------------
==3973373== 
==3973373==  Lock at 0x1FFEFFF038 was first observed
==3973373==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973373==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973373==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973373==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973373==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973373==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973373==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973373==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973373==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973373==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973373==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973373==  Address 0x1ffefff038 is on thread #1's stack
==3973373==  in frame #6, created by test_parallel_speedup() (test_custom.cc:737)
==3973373== 
==3973373== Possible data race during write of size 1 at 0x4E28628 by thread #3
==3973373== Locks held: none
==3973373==    at 0x10E21F: ThreadPool::worker(int) (thread-pool.cc:63)
==3973373==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973373==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973373==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973373==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973373==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973373==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973373==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x4BB2AA3: start_thread (pthread_create.c:447)
==3973373==    by 0x4C3FA33: clone (clone.S:100)
==3973373== 
==3973373== This conflicts with a previous read of size 1 by thread #2
==3973373== Locks held: 1, at address 0x1FFEFFF038
==3973373==    at 0x10DFAF: ThreadPool::dispatcher() (thread-pool.cc:31)
==3973373==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973373==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973373==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973373==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973373==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973373==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973373==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==  Address 0x4e28628 is 152 bytes inside a block of size 640 alloc'd
==3973373==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x11287D: std::__new_allocator<worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==3973373==    by 0x111AD6: allocate (alloc_traits.h:482)
==3973373==    by 0x111AD6: std::_Vector_base<worker, std::allocator<worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==3973373==    by 0x110DA0: std::_Vector_base<worker, std::allocator<worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==3973373==    by 0x110314: std::_Vector_base<worker, std::allocator<worker> >::_Vector_base(unsigned long, std::allocator<worker> const&) (stl_vector.h:335)
==3973373==    by 0x10FA98: std::vector<worker, std::allocator<worker> >::vector(unsigned long, std::allocator<worker> const&) (stl_vector.h:557)
==3973373==    by 0x10DCB0: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==3973373==    by 0x117C1B: test_parallel_speedup() (test_custom.cc:740)
==3973373==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973373==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973373==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973373==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973373==  Block was alloc'd by thread #1
==3973373== 
==3973373== ---Thread-Announcement------------------------------------------
==3973373== 
==3973373== Thread #6 was created
==3973373==    at 0x4C3FA23: clone (clone.S:76)
==3973373==    by 0x4C3FBA2: __clone_internal_fallback (clone-internal.c:64)
==3973373==    by 0x4C3FBA2: __clone_internal (clone-internal.c:109)
==3973373==    by 0x4BB254F: create_thread (pthread_create.c:297)
==3973373==    by 0x4BB31A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==3973373==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x4956EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==    by 0x10E896: std::thread::thread<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}, , void>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (std_thread.h:164)
==3973373==    by 0x10DD9E: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==3973373==    by 0x117C1B: test_parallel_speedup() (test_custom.cc:740)
==3973373==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973373==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973373==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973373== 
==3973373== ----------------------------------------------------------------
==3973373== 
==3973373==  Lock at 0x1FFEFFF038 was first observed
==3973373==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==3973373==    by 0x10F096: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==3973373==    by 0x10F36B: std::mutex::lock() (std_mutex.h:113)
==3973373==    by 0x10FDA4: std::unique_lock<std::mutex>::lock() (unique_lock.h:141)
==3973373==    by 0x10FC82: std::unique_lock<std::mutex>::unique_lock(std::mutex&) (unique_lock.h:71)
==3973373==    by 0x10DF24: ThreadPool::dispatcher() (thread-pool.cc:21)
==3973373==    by 0x10DC30: ThreadPool::ThreadPool(unsigned long)::{lambda()#1}::operator()() const (thread-pool.cc:12)
==3973373==    by 0x10EEC1: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:61)
==3973373==    by 0x10EE47: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#1}&&) (invoke.h:96)
==3973373==    by 0x10EDA1: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973373==    by 0x10ED49: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> >::operator()() (std_thread.h:299)
==3973373==    by 0x10ED11: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#1}> > >::_M_run() (std_thread.h:244)
==3973373==  Address 0x1ffefff038 is on thread #1's stack
==3973373==  in frame #1, created by test_parallel_speedup() (test_custom.cc:737)
==3973373== 
==3973373== Possible data race during write of size 1 at 0x1FFEFFF030 by thread #1
==3973373== Locks held: 1, at address 0x1FFEFFF038
==3973373==    at 0x10E5C4: ThreadPool::~ThreadPool() (thread-pool.cc:94)
==3973373==    by 0x117D08: test_parallel_speedup() (test_custom.cc:752)
==3973373==    by 0x12F7FA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==3973373==    by 0x12E49B: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==3973373==    by 0x12CB4B: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==3973373==    by 0x12AA0F: std::function<bool ()>::operator()() const (std_function.h:591)
==3973373==    by 0x118948: run_test(TestCase const&) (test_custom.cc:861)
==3973373==    by 0x119D91: main (test_custom.cc:942)
==3973373== 
==3973373== This conflicts with a previous read of size 1 by thread #6
==3973373== Locks held: none
==3973373==    at 0x10E173: ThreadPool::worker(int) (thread-pool.cc:58)
==3973373==    by 0x10DC58: ThreadPool::ThreadPool(unsigned long)::{lambda()#2}::operator()() const (thread-pool.cc:15)
==3973373==    by 0x10EE84: void std::__invoke_impl<void, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(std::__invoke_other, ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:61)
==3973373==    by 0x10EDF4: std::__invoke_result<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>::type std::__invoke<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}>(ThreadPool::ThreadPool(unsigned long)::{lambda()#2}&&) (invoke.h:96)
==3973373==    by 0x10ED75: void std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==3973373==    by 0x10ED2D: std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> >::operator()() (std_thread.h:299)
==3973373==    by 0x10ECED: std::thread::_State_impl<std::thread::_Invoker<std::tuple<ThreadPool::ThreadPool(unsigned long)::{lambda()#2}> > >::_M_run() (std_thread.h:244)
==3973373==    by 0x4956DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==3973373==  Address 0x1ffefff030 is on thread #1's stack
==3973373==  in frame #1, created by test_parallel_speedup() (test_custom.cc:737)
==3973373== 
==3973373== 
==3973373== Use --history-level=approx or =none to gain increased speed, at
==3973373== the cost of reduced accuracy of conflicting-access information
==3973373== For lists of detected and suppressed errors, rerun with: -s
==3973373== ERROR SUMMARY: 4 errors from 2 contexts (suppressed: 294 from 19)
[1;31m❌ FAILED[0m

========================================
Ran 31 tests.
❌ SOME TESTS FAILED
========================================
==3972411== 
==3972411== Use --history-level=approx or =none to gain increased speed, at
==3972411== the cost of reduced accuracy of conflicting-access information
==3972411== For lists of detected and suppressed errors, rerun with: -s
==3972411== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
